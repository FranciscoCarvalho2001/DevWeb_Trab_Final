@model IEnumerable<DevWeb_Trab_Final.Models.Reparacao>

@{
    ViewData["Title"] = "Index";
}
@{
    var cliente = Model.FirstOrDefault(c => User.Identity.Name.Equals(c.Dispositivo.Cliente.Email))?.Dispositivo.Cliente;

    var dispositivo = Model.Where(d => d.Dispositivo.Cliente.Email == cliente.Email);
    //var dispositivo = Model.FirstOrDefault(d => d.Dispositivo.Id.Equals(d.DispositivoFK))?.Dispositivo;
    //var cliente = Model.FirstOrDefault(c => c.Dispositivo.Cliente.Id.Equals(c.Dispositivo.ClienteFK))?.Dispositivo.ClienteFK;
    //var cliente = Model.FirstOrDefault(c => c.Dispositivo != null && c.Dispositivo.Cliente != null && c.Dispositivo.Cliente.Id.Equals(c.Dispositivo.ClienteFK))?.Dispositivo.Cliente;

}

@if (User.IsInRole("Cliente")) {

    @if(cliente.Email != null) {

        <h2>Reparações do @cliente.Nome</h2>

        <table class="table">
            <thead>
                <tr>
                    <th>Tipo</th>
                    <th>Modelo</th>
                    <th>Data Inicio</th>
                    <th>Data Fim</th>
                    <th>Nome Funcionario</th>

                </tr>
            </thead>
            <tbody>
                @foreach (var reparacao in dispositivo) {
                    <tr>
                        <td>@reparacao.Dispositivo.Tipo</td>
                        <td>@reparacao.Dispositivo.Modelo</td>
                        <td>@reparacao.DataInicio</td>
                        <td>@reparacao.DataFim</td>
                        <td>@reparacao.Funcionarios.Nome</td>
                    </tr>
                }
            </tbody>
        </table>
    }
}
    